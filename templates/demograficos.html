<!DOCTYPE html>
{% load static %}

<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Datos Demográficos</title>
    
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}" />
    <link rel="apple-touch-icon" type="image/x-icon" href="{% static 'favicon-16x16.png' %}" />
    <link rel="apple-touch-icon" type="image/x-icon" href="{% static 'favicon-32x32.png' %}" />
    <link rel="apple-touch-icon" type="image/x-icon" href="{% static 'android-chrome-192x192.png' %}" />
    <link rel="apple-touch-icon" type="image/x-icon" href="{% static 'android-chrome-512x512.png' %}" />

    <link rel="stylesheet" type="text/css" href="{% static 'demografico.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>

<body>
    <!-- HEADER -->
    <header>
        <img src="{% static 'header_banner.png' %}" alt="banner" id="header-image" />
    </header>

    <!-- MAIN CONTENT -->
    <main>
        <!-- TITLE -->
        <section>
            <h1>Datos Demográficos</h1>
        </section>

        <!-- INTRODUCTION -->
        <section>
            <p>INFORMACIóN DE LOS DATOS DEMOGRAFICOS.</p>
        </section>

        <!-- SUBBODY 1 -->
        <section>
            <h2>Importante</h2>
            <p>información de donde se encuentran los datos utilizados en las gráficas.</p>

            <!-- SUBBODY 2 -->
            <section>
                <h2>Instrucciones</h2>
                <p>1. Para seleccionar la variable que interesa representar gráficamente debe pasar encima del nombre de la variable continua al eje vertical (horizontal).</p>
                <p>2. Si desea comparar el dato de la variable presentada con el dato de las otras variables disponibles debe pasar encima del par ordenado (el punto en la gráfica).</p>
                <p>3. También, puede elegir el mes para el cual usted interesa la representación gráfica seleccionando el botón “Todos los meses”, ubicado debajo del eje horizontal.<strong> Nota:</strong> La serie que aparece en la gráfica no es la variable original, es una serie calculada. Esta serie es la diferencia entre la variable original y la tendencia. Por lo que si la serie original asume valores menores que la tendencia entonces la serie calculada (lo que aparece en la gráfica) tiene que asumir valores negativos.</p>
            </section>

            <!-- DROPDOWNS -->
            <section class="container-time">
                <select id="timeRange">
                    <option value="anual" class="active">Anual</option>
                    <option value="1980">1980</option>
                    <option value="1981">1981</option>
                    <option value="1982">1982</option>
                    <option value="1983">1983</option>
                    <option value="1984">1984</option>
                    <option value="1985">1985</option>
                    <option value="1986">1986</option>
                    <option value="1987">1987</option>
                    <option value="1988">1988</option>
                    <option value="1989">1989</option>
                    <option value="1990">1990</option>
                    <option value="1991">1991</option>
                    <option value="1992">1992</option>
                    <option value="1993">1993</option>
                    <option value="1994">1994</option>
                    <option value="1995">1995</option>
                    <option value="1996">1996</option>
                    <option value="1997">1997</option>
                    <option value="1998">1998</option>
                    <option value="1999">1999</option>
                    <option value="2000">2000</option>
                    <option value="2001">2001</option>
                    <option value="2002">2002</option>
                    <option value="2003">2003</option>
                    <option value="2004">2004</option>
                    <option value="2005">2005</option>
                    <option value="2006">2006</option>
                    <option value="2007">2007</option>
                </select>
            </section>

            <section class="graph-container">
                <select id="variableY">
                    <option value="{% static 'src/Demografic Data/Mortalidad.csv' %}" class="active">Mortalidad</option>
                    <option value="{% static 'src/Demografic Data/Natalidad.csv' %}">Natalidad</option>
                </select>
                <canvas id="myChart"></canvas>
            </section>

            <section class="container-X">
                <select id="variableX">
                    <option value="1_mes" class="active">(Por Mes)</option>
                    <option value="{% static 'src/Demografic Data/Mortalidad.csv' %}">Mortalidad</option>
                    <option value="{% static 'src/Demografic Data/Natalidad.csv' %}">Natalidad</option>
                </select>
            </section>

            <footer>
                <h1>Contáctenos</h1>
                <div class="footer-container">
                    <div class="left-container">
                        <h2>Oficiales de Información <br> (Ley 141-2019)</h2>
                        <p>Sr. Edgardo Vázquez Rivera <br> Secretario Oficina de Secretaría <br>
                            <a href="mailto:Vazquez_e@jp.pr.gov" class="custom-link">Vazquez_e@jp.pr.gov</a> <br> 787 723-6200 ext. 16637 <br><br>
                            Plan. Erika Rivera Felicié <br> Ayudante Especial <br>
                            <a href="mailto:ivera_e1@jp.pr.gov" class="custom-link">ivera_e1@jp.pr.gov</a> <br><br>
                            Lcda Aida Silver Cintrón <br> Abogada Oficina Asuntos Legales <br>
                            <a href="mailto:Silver_A@jp.pr.gov" class="custom-link">Silver_A@jp.pr.gov</a> <br> 787 723-6200 ext. 16016
                        </p>
                        <h2>Oficina de Datos PRITS</h2>
                        <p>Carlos Castillo Domena <br> Director Oficina de Administración Interna <br>
                            <a href="mailto:castillo_r@jp.pr.gov" class="custom-link">castillo_r@jp.pr.gov</a> <br> 787 723-6200 ext. 16019 <br><br>
                            <a href="https://jppr.sharepoint.com/sites/BibliotecaDigital" class="custom-link">BDV (Uso interno)</a>
                        </p>
                    </div>
                    <div class="right-container">
                        <h2><strong>Dirección Postal</strong></h2>
                        <p>PO Box 4119 <br> San Juan P.R. 00940-1119 <br> Tel: (787) 723-6200 (Cuadro)<br>
                        <h2><strong>Dirección Física</strong></h2>
                        <p>Centro Gubernamental<br> Roberto Sánchez Vilella<br> Ave. De Diego, Pda 22, <br> Santurce<br></p>
                        </p>
                        <section class="maps">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3784.7501887340845!2d-66.0698374248245!3d18.449648171336893!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8c036f497801a7b7%3A0x68ace32a0663b72f!2sGovernor%20Roberto%20S%C3%A1nchez%20Vilella%20Government%20Center!5e0!3m2!1sen!2sus!4v1717000266481!5m2!1sen!2sus" width="490" height="200" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </section>
                    </div>
                </div>
            </footer>
        </section>
    </main>

    <!-- Script to load data and create the chart -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to load data and update the chart
            function loadChartData(csvFile) {
                console.log(`Loading data from: ${csvFile}`);
                Papa.parse(csvFile, {
                    download: true,
                    header: true,
                    complete: function(results) {
                        console.log('CSV data:', results.data);
                        if (results.data.length === 0) {
                            console.error('No data found in CSV file.');
                            return;
                        }

                        var labels = results.data.map(d => d.label); // Adjust according to your CSV structure
                        var data = results.data.map(d => parseFloat(d.value));  // Adjust according to your CSV structure

                        var ctx = document.getElementById('myChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Datos Demográficos',
                                    data: data,
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    fill: false
                                }]
                            },
                            options: {
                                responsive: true
                            }
                        });
                    }
                });
            }

            // Initial load
            loadChartData(document.getElementById('variableY').value);

            // Update chart on dropdown change
            document.getElementById('variableY').addEventListener('change', function() {
                loadChartData(this.value);
            });
        });
    </script>
</body>
</html>